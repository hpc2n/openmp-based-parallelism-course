<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Introduction to Kebnekaise &mdash; OpenMP parallelism in scientific computing  documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css" />

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex/" />
    <link rel="search" title="Search" href="../search/" />
    <link rel="next" title="Introduction to OpenMP (part 1)" href="../openmp-basics1/" />
    <link rel="prev" title="Introduction to HPC2N" href="../hpc2n-intro/" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../" class="icon icon-home">
            OpenMP parallelism in scientific computing
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search/" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Day 1</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../hpc2n-intro/">Introduction to HPC2N</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Introduction to Kebnekaise</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#modules-and-toolchains">Modules and toolchains</a></li>
<li class="toctree-l2"><a class="reference internal" href="#compile-c-code">Compile C code</a></li>
<li class="toctree-l2"><a class="reference internal" href="#compile-cuda-code">Compile CUDA code</a></li>
<li class="toctree-l2"><a class="reference internal" href="#course-project-and-reservation">Course project and reservation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#submitting-jobs">Submitting jobs</a></li>
<li class="toctree-l2"><a class="reference internal" href="#aliases">Aliases</a></li>
<li class="toctree-l2"><a class="reference internal" href="#batch-files">Batch files</a></li>
<li class="toctree-l2"><a class="reference internal" href="#job-queue">Job queue</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../openmp-basics1/">Introduction to OpenMP (part 1)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../openmp-basics2/">Introduction to OpenMP (part 2)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Day 2</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../motivation/">Introduction to task-based parallelism</a></li>
<li class="toctree-l1"><a class="reference internal" href="../task-basics-1/">OpenMP task basics (part 1)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../task-basics-2/">OpenMP task basics (part 2)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../task-basics-lu/">Example: LU factorization</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Day 3</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../two-sided-algorithms/">Demonstration: Two-sided matrix algorithms</a></li>
<li class="toctree-l1"><a class="reference internal" href="../starpu1/">StarPU runtime system (part 1)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../starpu2/">StarPU runtime system (part 2)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../starpu-lu/">Example: LU factorization</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Miscellanous</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../quick-reference/">Quick Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../guide/">Instructor’s guide</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../">OpenMP parallelism in scientific computing</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Introduction to Kebnekaise</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/hpc2n/OpenMP-parallelism-course/blob/master/docs/setup.rst" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="introduction-to-kebnekaise">
<h1>Introduction to Kebnekaise<a class="headerlink" href="#introduction-to-kebnekaise" title="Permalink to this heading"></a></h1>
<section id="modules-and-toolchains">
<h2>Modules and toolchains<a class="headerlink" href="#modules-and-toolchains" title="Permalink to this heading"></a></h2>
<p>You need to <strong>load the correct toolchain</strong> before compiling your code on Kebnekaise.</p>
<p>The <strong>available modules</strong> are listed using the <code class="code docutils literal notranslate"><span class="pre">ml</span> <span class="pre">avail</span></code> command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>ml<span class="w"> </span>avail
-------------------------<span class="w"> </span>/hpc2n/eb/modules/all/Core<span class="w"> </span>--------------------------
Bison/3.0.5<span class="w">                        </span>fosscuda/2020a
Bison/3.3.2<span class="w">                        </span>fosscuda/2020b<span class="w">        </span><span class="o">(</span>D<span class="o">)</span>
Bison/3.5.3<span class="w">                        </span>gaussian/16.C.01-AVX2
Bison/3.7.1<span class="w">                </span><span class="o">(</span>D<span class="o">)</span><span class="w">     </span>gcccuda/2019b
CUDA/8.0.61<span class="w">                        </span>gcccuda/2020a
CUDA/10.1.243<span class="w">              </span><span class="o">(</span>D<span class="o">)</span><span class="w">     </span>gcccuda/2020b<span class="w">         </span><span class="o">(</span>D<span class="o">)</span>
...
</pre></div>
</div>
<p>The list shows the modules you can load directly, and so may change if you have loaded modules.</p>
<p>In order to see all the modules, including those that have prerequisites to load, use the command <code class="code docutils literal notranslate"><span class="pre">ml</span> <span class="pre">spider</span></code>. Many types of application software fall in this category.</p>
<p>You can find more <strong>information</strong> regarding a particular module using the <code class="code docutils literal notranslate"><span class="pre">ml</span> <span class="pre">spider</span> <span class="pre">&lt;module&gt;</span></code> command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>ml<span class="w"> </span>spider<span class="w"> </span>MATLAB

---------------------------------------------------------------------------
MATLAB:<span class="w"> </span>MATLAB/2019b.Update2
---------------------------------------------------------------------------
<span class="w">    </span>Description:
<span class="w">    </span>MATLAB<span class="w"> </span>is<span class="w"> </span>a<span class="w"> </span>high-level<span class="w"> </span>language<span class="w"> </span>and<span class="w"> </span>interactive<span class="w"> </span>environment<span class="w"> </span>that
<span class="w">    </span>enables<span class="w"> </span>you<span class="w"> </span>to<span class="w"> </span>perform<span class="w"> </span>computationally<span class="w"> </span>intensive<span class="w"> </span>tasks<span class="w"> </span>faster<span class="w"> </span>than
<span class="w">    </span>with<span class="w"> </span>traditional<span class="w"> </span>programming<span class="w"> </span>languages<span class="w"> </span>such<span class="w"> </span>as<span class="w"> </span>C,<span class="w"> </span>C++,<span class="w"> </span>and<span class="w"> </span>Fortran.


<span class="w">    </span>This<span class="w"> </span>module<span class="w"> </span>can<span class="w"> </span>be<span class="w"> </span>loaded<span class="w"> </span>directly:<span class="w"> </span>module<span class="w"> </span>load<span class="w"> </span>MATLAB/2019b.Update2

<span class="w">    </span>Help:
<span class="w">    </span><span class="nv">Description</span>
<span class="w">    </span><span class="o">===========</span>
<span class="w">    </span>MATLAB<span class="w"> </span>is<span class="w"> </span>a<span class="w"> </span>high-level<span class="w"> </span>language<span class="w"> </span>and<span class="w"> </span>interactive<span class="w"> </span>environment
<span class="w">    </span>that<span class="w"> </span>enables<span class="w"> </span>you<span class="w"> </span>to<span class="w"> </span>perform<span class="w"> </span>computationally<span class="w"> </span>intensive<span class="w"> </span>tasks<span class="w"> </span>faster<span class="w"> </span>than<span class="w"> </span>with
<span class="w">    </span>traditional<span class="w"> </span>programming<span class="w"> </span>languages<span class="w"> </span>such<span class="w"> </span>as<span class="w"> </span>C,<span class="w"> </span>C++,<span class="w"> </span>and<span class="w"> </span>Fortran.


<span class="w">    </span>More<span class="w"> </span><span class="nv">information</span>
<span class="w">    </span><span class="o">================</span>
<span class="w">    </span>-<span class="w"> </span>Homepage:<span class="w"> </span>http://www.mathworks.com/products/matlab
</pre></div>
</div>
<p>You can <strong>load</strong> the module using the <code class="code docutils literal notranslate"><span class="pre">ml</span> <span class="pre">&lt;module&gt;</span></code> command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>ml<span class="w"> </span>MATLAB/2019b.Update2
</pre></div>
</div>
<p>You can <strong>list loaded modules</strong> using the <code class="code docutils literal notranslate"><span class="pre">ml</span></code> command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>ml

Currently<span class="w"> </span>Loaded<span class="w"> </span>Modules:
<span class="w"> </span><span class="m">1</span><span class="o">)</span><span class="w"> </span>snicenvironment<span class="w">     </span><span class="o">(</span>S<span class="o">)</span><span class="w">   </span><span class="m">7</span><span class="o">)</span><span class="w"> </span>libevent/2.1.11<span class="w">    </span><span class="m">13</span><span class="o">)</span><span class="w"> </span>PMIx/3.0.2
<span class="w"> </span><span class="m">2</span><span class="o">)</span><span class="w"> </span>systemdefault<span class="w">       </span><span class="o">(</span>S<span class="o">)</span><span class="w">   </span><span class="m">8</span><span class="o">)</span><span class="w"> </span>numactl/2.0.12<span class="w">     </span><span class="m">14</span><span class="o">)</span><span class="w"> </span>impi/2018.4.274
<span class="w"> </span><span class="m">3</span><span class="o">)</span><span class="w"> </span>GCCcore/8.2.0<span class="w">             </span><span class="m">9</span><span class="o">)</span><span class="w"> </span>XZ/5.2.4<span class="w">           </span><span class="m">15</span><span class="o">)</span><span class="w"> </span>imkl/2019.1.144
<span class="w"> </span><span class="m">4</span><span class="o">)</span><span class="w"> </span>zlib/1.2.11<span class="w">              </span><span class="m">10</span><span class="o">)</span><span class="w"> </span>libxml2/2.9.8<span class="w">      </span><span class="m">16</span><span class="o">)</span><span class="w"> </span>intel/2019a
<span class="w"> </span><span class="m">5</span><span class="o">)</span><span class="w"> </span>binutils/2.31.1<span class="w">          </span><span class="m">11</span><span class="o">)</span><span class="w"> </span>libpciaccess/0.14<span class="w">  </span><span class="m">17</span><span class="o">)</span><span class="w"> </span>MATLAB/2019b.Update2
<span class="w"> </span><span class="m">6</span><span class="o">)</span><span class="w"> </span>iccifort/2019.1.144<span class="w">      </span><span class="m">12</span><span class="o">)</span><span class="w"> </span>hwloc/1.11.11

Where:
<span class="w"> </span>S:<span class="w">  </span>Module<span class="w"> </span>is<span class="w"> </span>Sticky,<span class="w"> </span>requires<span class="w"> </span>--force<span class="w"> </span>to<span class="w"> </span>unload<span class="w"> </span>or<span class="w"> </span>purge
</pre></div>
</div>
<p>You can <strong>unload all modules</strong> using the <code class="code docutils literal notranslate"><span class="pre">ml</span> <span class="pre">purge</span></code> command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>ml<span class="w"> </span>purge
The<span class="w"> </span>following<span class="w"> </span>modules<span class="w"> </span>were<span class="w"> </span>not<span class="w"> </span>unloaded:
<span class="w">  </span><span class="o">(</span>Use<span class="w"> </span><span class="s2">&quot;module --force purge&quot;</span><span class="w"> </span>to<span class="w"> </span>unload<span class="w"> </span>all<span class="o">)</span>:

<span class="w">  </span><span class="m">1</span><span class="o">)</span><span class="w"> </span>systemdefault<span class="w">   </span><span class="m">2</span><span class="o">)</span><span class="w"> </span>snicenvironment
</pre></div>
</div>
<p>Note that the <code class="code docutils literal notranslate"><span class="pre">ml</span> <span class="pre">purge</span></code> command will warn that two modules were not unloaded.
This is normal and you should <strong>NOT</strong> force unload them.</p>
</section>
<section id="compile-c-code">
<h2>Compile C code<a class="headerlink" href="#compile-c-code" title="Permalink to this heading"></a></h2>
<p>Once the correct toolchain (<code class="code docutils literal notranslate"><span class="pre">foss/2020b</span></code>) has been loaded, we can compile C source files (<code class="code docutils literal notranslate"><span class="pre">*.c</span></code>) with the GNU compiler:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>gcc<span class="w"> </span>-o<span class="w"> </span>&lt;binary<span class="w"> </span>name&gt;<span class="w"> </span>&lt;sources&gt;<span class="w"> </span>-Wall
</pre></div>
</div>
<p>The <code class="code docutils literal notranslate"><span class="pre">-Wall</span></code> causes the compiler to print additional warnings.</p>
</section>
<section id="compile-cuda-code">
<h2>Compile CUDA code<a class="headerlink" href="#compile-cuda-code" title="Permalink to this heading"></a></h2>
<p>Once the correct toolchain (<code class="code docutils literal notranslate"><span class="pre">fosscuda/2020b</span></code>) has been loaded, we can compile CU source files (<code class="code docutils literal notranslate"><span class="pre">*.cu</span></code>) with the <code class="code docutils literal notranslate"><span class="pre">nvcc</span></code> compiler:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>nvcc<span class="w"> </span>-o<span class="w"> </span>&lt;binary<span class="w"> </span>name&gt;<span class="w"> </span>&lt;sources&gt;<span class="w"> </span>-Xcompiler<span class="o">=</span><span class="s2">&quot;-Wall&quot;</span>
</pre></div>
</div>
<p>This passes the <code class="code docutils literal notranslate"><span class="pre">-Wall</span></code> flag to <code class="code docutils literal notranslate"><span class="pre">g++</span></code>. The flag causes the compiler to print extra warnings.</p>
</section>
<section id="course-project-and-reservation">
<h2>Course project and reservation<a class="headerlink" href="#course-project-and-reservation" title="Permalink to this heading"></a></h2>
<p>During the course, you can use the <strong>course reservations</strong> (snic2021-22-272-cpu-day[1|2|3] and snic2021-22-272-gpu-day[1|2|3]) to get faster access to the compute nodes.
The reservations are valid during the time 9:00-13:00 on each of the three days (10-12 May 2021).
Note that capitalization matters for reservations!</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Day</p></th>
<th class="head"><p>CPU only</p></th>
<th class="head"><p>CPU + GPU</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Monday</p></td>
<td><p>snic2021-22-272-cpu-day1</p></td>
<td><p>snic2021-22-272-gpu-day1</p></td>
</tr>
<tr class="row-odd"><td><p>Tuesday</p></td>
<td><p>snic2021-22-272-cpu-day2</p></td>
<td><p>snic2021-22-272-gpu-day1</p></td>
</tr>
<tr class="row-even"><td><p>Wednesday</p></td>
<td><p>snic2021-22-272-cpu-day3</p></td>
<td><p>snic2021-22-272-gpu-day1</p></td>
</tr>
</tbody>
</table>
<p>Note that jobs that are submitted using a reservation are not scheduled outside the reservation time window.
You can, however, submit jobs without the reservation as long as you are a member of an active project.
The <strong>course project</strong> <code class="code docutils literal notranslate"><span class="pre">SNIC2021-22-272</span></code> is valid until 2021-06-01.</p>
</section>
<section id="submitting-jobs">
<h2>Submitting jobs<a class="headerlink" href="#submitting-jobs" title="Permalink to this heading"></a></h2>
<p>The jobs are <strong>submitted</strong> using the <code class="code docutils literal notranslate"><span class="pre">srun</span></code> command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>srun<span class="w"> </span>--account<span class="o">=</span>&lt;account&gt;<span class="w"> </span>--ntasks<span class="o">=</span>&lt;task<span class="w"> </span>count&gt;<span class="w"> </span>--time<span class="o">=</span>&lt;time&gt;<span class="w"> </span>&lt;command&gt;
</pre></div>
</div>
<p>This places the command into the batch queue.
The three arguments are the project number, the number of tasks, and the requested time allocation.
For example, the following command prints the uptime of the allocated compute node:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>srun<span class="w"> </span>--account<span class="o">=</span>SNIC2021-22-272<span class="w"> </span>--ntasks<span class="o">=</span><span class="m">1</span><span class="w"> </span>--time<span class="o">=</span><span class="m">00</span>:00:15<span class="w"> </span>uptime
srun:<span class="w"> </span>job<span class="w"> </span><span class="m">12727702</span><span class="w"> </span>queued<span class="w"> </span>and<span class="w"> </span>waiting<span class="w"> </span><span class="k">for</span><span class="w"> </span>resources
srun:<span class="w"> </span>job<span class="w"> </span><span class="m">12727702</span><span class="w"> </span>has<span class="w"> </span>been<span class="w"> </span>allocated<span class="w"> </span>resources
<span class="w"> </span><span class="m">11</span>:53:43<span class="w"> </span>up<span class="w"> </span><span class="m">5</span><span class="w"> </span>days,<span class="w">  </span><span class="m">1</span>:23,<span class="w">  </span><span class="m">0</span><span class="w"> </span>users,<span class="w">  </span>load<span class="w"> </span>average:<span class="w"> </span><span class="m">23</span>,11,<span class="w"> </span><span class="m">23</span>,20,<span class="w"> </span><span class="m">23</span>,27
</pre></div>
</div>
<p>Note that we are using the course project, the number of tasks is set to one, and we are requesting 15 seconds.</p>
<p>When the <strong>reservation</strong> is valid, you can specify it using the <code class="code docutils literal notranslate"><span class="pre">--reservation=&lt;reservation&gt;</span></code> argument:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>srun<span class="w"> </span>--account<span class="o">=</span>SNIC2021-22-272<span class="w"> </span>--reservation<span class="o">=</span>snic2021-22-272-cpu-day1<span class="w"> </span>--ntasks<span class="o">=</span><span class="m">1</span><span class="w"> </span>--time<span class="o">=</span><span class="m">00</span>:00:15<span class="w"> </span>uptime
<span class="w"> </span><span class="m">11</span>:58:43<span class="w"> </span>up<span class="w"> </span><span class="m">6</span><span class="w"> </span>days,<span class="w">  </span><span class="m">1</span>:23,<span class="w">  </span><span class="m">0</span><span class="w"> </span>users,<span class="w">  </span>load<span class="w"> </span>average:<span class="w"> </span><span class="m">23</span>,11,<span class="w"> </span><span class="m">22</span>,20,<span class="w"> </span><span class="m">21</span>,27
</pre></div>
</div>
<p>were N in dayN is either 1, 2, 3 and cpu can be replaced with gpu if you are running a GPU job.</p>
<p>We could submit <strong>multiple tasks</strong> using the <code class="code docutils literal notranslate"><span class="pre">--ntasks=&lt;task</span> <span class="pre">count&gt;</span></code> argument:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>srun<span class="w"> </span>--account<span class="o">=</span>SNIC2021-22-272<span class="w"> </span>--reservation<span class="o">=</span>snic2021-22-272-cpu-day1<span class="w"> </span>--ntasks<span class="o">=</span><span class="m">4</span><span class="w"> </span>--time<span class="o">=</span><span class="m">00</span>:00:15<span class="w"> </span>uname<span class="w"> </span>-n
b-cn0932.hpc2n.umu.se
b-cn0932.hpc2n.umu.se
b-cn0932.hpc2n.umu.se
b-cn0932.hpc2n.umu.se
</pre></div>
</div>
<p>Note that all task are running on the same node.
We could request <strong>multiple CPU cores</strong> for each task using the <code class="code docutils literal notranslate"><span class="pre">--cpus-per-task=&lt;cpu</span> <span class="pre">count&gt;</span></code> argument:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>srun<span class="w"> </span>--account<span class="o">=</span>SNIC2021-22-272<span class="w"> </span>--reservation<span class="o">=</span>snic2021-22-272-cpu-day1<span class="w"> </span>--ntasks<span class="o">=</span><span class="m">4</span><span class="w"> </span>--cpus-per-task<span class="o">=</span><span class="m">14</span><span class="w"> </span>--time<span class="o">=</span><span class="m">00</span>:00:15<span class="w"> </span>uname<span class="w"> </span>-n
b-cn0935.hpc2n.umu.se
b-cn0935.hpc2n.umu.se
b-cn0932.hpc2n.umu.se
b-cn0932.hpc2n.umu.se
</pre></div>
</div>
<p>If you want to measure the performance, it is advisable to request an <strong>exclusive access</strong> to the compute nodes (<code class="code docutils literal notranslate"><span class="pre">--exclusive</span></code>):</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>srun<span class="w"> </span>--account<span class="o">=</span>SNIC2021-22-272<span class="w"> </span>--reservation<span class="o">=</span>snic2021-22-272-cpu-day1<span class="w"> </span>--ntasks<span class="o">=</span><span class="m">4</span><span class="w"> </span>--cpus-per-task<span class="o">=</span><span class="m">14</span><span class="w"> </span>--exclusive<span class="w"> </span>--time<span class="o">=</span><span class="m">00</span>:00:15<span class="w"> </span>uname<span class="w"> </span>-n
b-cn0935.hpc2n.umu.se
b-cn0935.hpc2n.umu.se
b-cn0932.hpc2n.umu.se
b-cn0932.hpc2n.umu.se
</pre></div>
</div>
<p>Finally, we could request a <strong>single Nvidia Tesla V100 GPU</strong> and 14 CPU cores using the <code class="code docutils literal notranslate"><span class="pre">--gres=gpu:v100:1,gpuexcl</span></code> argument:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>srun<span class="w"> </span>--account<span class="o">=</span>SNIC2021-22-272<span class="w"> </span>--reservation<span class="o">=</span>snic2021-22-272-gpu-day1<span class="w"> </span>--ntasks<span class="o">=</span><span class="m">1</span><span class="w"> </span>--gres<span class="o">=</span>gpu:v100:1,gpuexcl<span class="w"> </span>--time<span class="o">=</span><span class="m">00</span>:00:15<span class="w"> </span>nvidia-smi
Wed<span class="w"> </span>Apr<span class="w"> </span><span class="m">21</span><span class="w"> </span><span class="m">12</span>:59:15<span class="w"> </span><span class="m">2021</span>
+-----------------------------------------------------------------------------+
<span class="p">|</span><span class="w"> </span>NVIDIA-SMI<span class="w"> </span><span class="m">460</span>.67<span class="w">       </span>Driver<span class="w"> </span>Version:<span class="w"> </span><span class="m">460</span>.67<span class="w">       </span>CUDA<span class="w"> </span>Version:<span class="w"> </span><span class="m">11</span>.2<span class="w">     </span><span class="p">|</span>
<span class="p">|</span>-------------------------------+----------------------+----------------------+
<span class="p">|</span><span class="w"> </span>GPU<span class="w">  </span>Name<span class="w">        </span>Persistence-M<span class="p">|</span><span class="w"> </span>Bus-Id<span class="w">        </span>Disp.A<span class="w"> </span><span class="p">|</span><span class="w"> </span>Volatile<span class="w"> </span>Uncorr.<span class="w"> </span>ECC<span class="w"> </span><span class="p">|</span>
<span class="p">|</span><span class="w"> </span>Fan<span class="w">  </span>Temp<span class="w">  </span>Perf<span class="w">  </span>Pwr:Usage/Cap<span class="p">|</span><span class="w">         </span>Memory-Usage<span class="w"> </span><span class="p">|</span><span class="w"> </span>GPU-Util<span class="w">  </span>Compute<span class="w"> </span>M.<span class="w"> </span><span class="p">|</span>
<span class="p">|</span><span class="w">                               </span><span class="p">|</span><span class="w">                      </span><span class="p">|</span><span class="w">               </span>MIG<span class="w"> </span>M.<span class="w"> </span><span class="p">|</span>
<span class="p">|</span><span class="o">===============================</span>+<span class="o">======================</span>+<span class="o">======================</span><span class="p">|</span>
<span class="p">|</span><span class="w">   </span><span class="m">0</span><span class="w">  </span>Tesla<span class="w"> </span>V100-PCIE...<span class="w">  </span>On<span class="w">   </span><span class="p">|</span><span class="w"> </span><span class="m">00000000</span>:58:00.0<span class="w"> </span>Off<span class="w"> </span><span class="p">|</span><span class="w">                    </span><span class="m">0</span><span class="w"> </span><span class="p">|</span>
<span class="p">|</span><span class="w"> </span>N/A<span class="w">   </span>33C<span class="w">    </span>P0<span class="w">    </span>26W<span class="w"> </span>/<span class="w"> </span>250W<span class="w"> </span><span class="p">|</span><span class="w">      </span>0MiB<span class="w"> </span>/<span class="w"> </span>16160MiB<span class="w"> </span><span class="p">|</span><span class="w">      </span><span class="m">0</span>%<span class="w">      </span>Default<span class="w"> </span><span class="p">|</span>
<span class="p">|</span><span class="w">                               </span><span class="p">|</span><span class="w">                      </span><span class="p">|</span><span class="w">                  </span>N/A<span class="w"> </span><span class="p">|</span>
+-------------------------------+----------------------+----------------------+

+-----------------------------------------------------------------------------+
<span class="p">|</span><span class="w"> </span>Processes:<span class="w">                                                                  </span><span class="p">|</span>
<span class="p">|</span><span class="w">  </span>GPU<span class="w">   </span>GI<span class="w">   </span>CI<span class="w">        </span>PID<span class="w">   </span>Type<span class="w">   </span>Process<span class="w"> </span>name<span class="w">                  </span>GPU<span class="w"> </span>Memory<span class="w"> </span><span class="p">|</span>
<span class="p">|</span><span class="w">        </span>ID<span class="w">   </span>ID<span class="w">                                                   </span>Usage<span class="w">      </span><span class="p">|</span>
<span class="p">|</span><span class="o">=============================================================================</span><span class="p">|</span>
<span class="p">|</span><span class="w">  </span>No<span class="w"> </span>running<span class="w"> </span>processes<span class="w"> </span>found<span class="w">                                                 </span><span class="p">|</span>
+-----------------------------------------------------------------------------+
</pre></div>
</div>
</section>
<section id="aliases">
<h2>Aliases<a class="headerlink" href="#aliases" title="Permalink to this heading"></a></h2>
<p>In order to save time, you can create an <strong>alias</strong> for a command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span><span class="nb">alias</span><span class="w"> </span>&lt;alist&gt;<span class="o">=</span><span class="s2">&quot;&lt;command&gt;&quot;</span>
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span><span class="nb">alias</span><span class="w"> </span><span class="nv">run_full</span><span class="o">=</span><span class="s2">&quot;srun --account=SNIC2021-22-272 --reservation=snic2021-22-272-cpu-day1 --ntasks=1 --cpus-per-task=28 --time=00:05:00&quot;</span>
$<span class="w"> </span>run_full<span class="w"> </span>uname<span class="w"> </span>-n
b-cn0932.hpc2n.umu.se
</pre></div>
</div>
</section>
<section id="batch-files">
<h2>Batch files<a class="headerlink" href="#batch-files" title="Permalink to this heading"></a></h2>
<p>It is often more convenient to write the commands into a <strong>batch file</strong>.
For example, we could write the following to a file called <code class="code docutils literal notranslate"><span class="pre">batch.sh</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="ch">#!/bin/bash</span>
<span class="linenos"> 2</span><span class="c1">#SBATCH --account=SNIC2021-22-272</span>
<span class="linenos"> 3</span><span class="c1">#SBATCH --reservation=snic2021-22-272-cpu-day1</span>
<span class="linenos"> 4</span><span class="c1">#SBATCH --ntasks=1</span>
<span class="linenos"> 5</span><span class="c1">#SBATCH --time=00:00:15</span>
<span class="linenos"> 6</span>
<span class="linenos"> 7</span>ml<span class="w"> </span>purge
<span class="linenos"> 8</span>ml<span class="w"> </span>foss/2020b
<span class="linenos"> 9</span>
<span class="linenos">10</span>uname<span class="w"> </span>-n
</pre></div>
</div>
<p>Note that the same arguments that were earlier passed to the <code class="code docutils literal notranslate"><span class="pre">srun</span></code> command are now given as comments.
It is highly advisable to purge all loaded modules and re-load the required modules as the job inherits the environment.
The batch file is submitted using the <code class="code docutils literal notranslate"><span class="pre">sbatch</span> <span class="pre">&lt;batch</span> <span class="pre">file&gt;</span></code> command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sbatch<span class="w"> </span>batch.sh
Submitted<span class="w"> </span>batch<span class="w"> </span>job<span class="w"> </span><span class="m">12728675</span>
</pre></div>
</div>
<p>By default, the output is directed to the file <code class="code docutils literal notranslate"><span class="pre">slurm-&lt;job_id&gt;.out</span></code>, where <code class="code docutils literal notranslate"><span class="pre">&lt;job_id&gt;</span></code> is the <strong>job id</strong> returned by the <code class="code docutils literal notranslate"><span class="pre">sbatch</span></code> command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>cat<span class="w"> </span>slurm-12728675.out
The<span class="w"> </span>following<span class="w"> </span>modules<span class="w"> </span>were<span class="w"> </span>not<span class="w"> </span>unloaded:
<span class="w"> </span><span class="o">(</span>Use<span class="w"> </span><span class="s2">&quot;module --force purge&quot;</span><span class="w"> </span>to<span class="w"> </span>unload<span class="w"> </span>all<span class="o">)</span>:

<span class="w"> </span><span class="m">1</span><span class="o">)</span><span class="w"> </span>systemdefault<span class="w">   </span><span class="m">2</span><span class="o">)</span><span class="w"> </span>snicenvironment
b-cn0102.hpc2n.umu.se
</pre></div>
</div>
</section>
<section id="job-queue">
<h2>Job queue<a class="headerlink" href="#job-queue" title="Permalink to this heading"></a></h2>
<p>You can <strong>investigate the job queue</strong> with the <code class="code docutils literal notranslate"><span class="pre">squeue</span></code> command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>squeue<span class="w"> </span>-u<span class="w"> </span><span class="nv">$USER</span>
</pre></div>
</div>
<p>If you want an estimate for when the job will start running, you can give the <code class="code docutils literal notranslate"><span class="pre">squeue</span></code> command the argument <code class="code docutils literal notranslate"><span class="pre">--start</span></code>.</p>
<p>You can <strong>cancel</strong> a job with the <code class="code docutils literal notranslate"><span class="pre">scancel</span></code> command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>scancel<span class="w"> </span>&lt;job_id&gt;
</pre></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../hpc2n-intro/" class="btn btn-neutral float-left" title="Introduction to HPC2N" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../openmp-basics1/" class="btn btn-neutral float-right" title="Introduction to OpenMP (part 1)" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, The contributors.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>